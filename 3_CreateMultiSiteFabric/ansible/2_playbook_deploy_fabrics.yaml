---
- name: IaC Workshop - Trigger Build & Deploy Configuration for MSD Fabric
  hosts: ndfc
  gather_facts: false
  connection: httpapi
  collections:
    - cisco.dcnm
  vars:
    pod_num: 1
  tasks:
    - name: POST Config Save
      dcnm_rest:
        method: POST
        path: "/appcenter/cisco/ndfc/api/v1/lan-fabric/rest/control/fabrics/AUTO-POD{{pod_num}}-MSD/config-save"
        data: null
      ignore_errors: yes
      timeout: 180
    - name: Pause for 2 minutes
      ansible.builtin.pause:
        minutes: 2
    - name: POST Config Deploy
      dcnm_rest:
        method: POST
        path: "/appcenter/cisco/ndfc/api/v1/lan-fabric/rest/control/fabrics/AUTO-POD{{pod_num}}-MSD/config-deploy?inclAllMSDSwitches=true"
        data: null
      ignore_errors: yes
      timeout: 180
